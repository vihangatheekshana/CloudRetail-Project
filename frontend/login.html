<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login | CloudRetail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #800000; height: 100vh; display: flex; align-items: center; }
        .login-card { max-width: 400px; margin: auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-maroon { background: #800000; color: white; border: none; }
        .btn-maroon:hover { background: #600000; color: white; }
    </style>
</head>
<body>
    <div class="login-card w-100 shadow-lg">
        <h3 class="text-center mb-4" style="color: #800000;">CloudRetail Login</h3>
        <form id="loginForm">
            <div class="mb-3">
                <label class="form-label">Email Address</label>
                <input type="email" id="email" class="form-control" placeholder="example@mail.com" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Password</label>
                <input type="password" id="password" class="form-control" placeholder="••••••••" required>
            </div>
            <button type="submit" class="btn btn-maroon w-100 py-2">Login to My Account</button>
        </form>
        <p class="text-center mt-3 small">New to CloudRetail? <a href="register.html">Register here</a></p>
    </div>

    <script>
        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            
            try {
                const res = await fetch('https://ejch59j8vl.execute-api.eu-north-1.amazonaws.com/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        email: document.getElementById('email').value,
                        password: document.getElementById('password').value
                    })
                });

                const data = await res.json();

                if(res.ok) {
                    // Save Session Data
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('userName', data.user_name);
                    localStorage.setItem('userEmail', document.getElementById('email').value);
                    localStorage.setItem('userRole', data.role); // Important for Admin access

                    alert("Login Successful! Welcome " + data.user_name);
                    
                    // Logic to redirect Admin vs Customer
                    if(data.role === 'admin') {
                        window.location.href = "admin.html";
                    } else {
                        window.location.href = "index.html";
                    }
                } else {
                    // This will now show "Invalid Email or Password" or "Invalid credentials"
                    alert("Error: " + (data.error || data.message));
                }
            } catch (error) {
                console.error("Connection Error:", error);
                alert("Failed to connect to the AWS Login Service. Please check your internet connection.");
            }
        };
    </script>
</body>

</html>

